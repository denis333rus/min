{% extends "base.html" %}

{% block title %}{{ '–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' if role=='admin' else '–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' }}{% endblock %}

{% block extra_css %}
<style>
.login-card { background:#fff; padding: 36px 28px; border-radius: 18px; box-shadow: 0 8px 32px rgba(0,0,0,0.13); max-width: 420px; margin: 0 auto; transition: box-shadow 0.21s;}
.login-header { text-align:center; margin-bottom: 24px;}
.login-header h1 { margin:0 0 10px 0; font-size:2rem;}
.muted { color:#888; font-size:1.06rem;}
.field-with-icon { position:relative; }
.toggle-password { position: absolute; right:11px; top:36px; background: #f5f5f5; border-radius:50%; border:none; font-size:18px; cursor:pointer; color:#888; width:34px; height:34px; display:flex; align-items:center; justify-content:center; transition:background 0.2s; }
.toggle-password:hover { background:#ececec; color:#444; }
.form-group { margin-bottom: 22px; }
input[type="text"], input[type="password"] { width:100%; padding:12px 13px; border:1.2px solid #e3e3e3; border-radius:9px; font-size:1rem; background:#fafbfc; transition: border-color 0.18s;}
input[type="text"]:focus, input[type="password"]:focus { border-color:#ffd700; outline:none; background:#fff; }
.submit-button { width:100%; background:linear-gradient(90deg,#ffd700,#ffd700); color:#fff; border:none; border-radius:9px; padding:13px; margin-top:12px; font-size:1.10rem; font-weight:500; cursor:pointer; transition: box-shadow 0.23s, background 0.13s; box-shadow: 0 1px 6px rgba(41,93,214,0.07);}
.submit-button:active { box-shadow: 0 2px 10px #618ffb28; background:#ffd700;}
.message.error { background: #ffe0e4; color:#a11024; border: 1.1px solid #ef859e; border-radius:7px; font-size:1rem; padding:10px 16px 11px 15px; box-shadow: 0 2px 8px #ed639c19; margin-bottom: 15px; }
.caps-warning { color: #b33500; font-size: 0.98em; margin-top: 3px; margin-left:4px; display:none;}
@media (max-width: 600px) {
  .login-card {padding: 19px 4vw; max-width: 99vw}
  .admin-section {padding:30px 0;}
}
</style>
{% endblock %}

{% block content %}
<section class="admin-section" style="padding: 60px 0; min-height: 60vh;">
  <div class="admin-container" style="max-width: 640px; margin: 0 auto;">
    <div class="login-card">
      <div class="login-header">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="–õ–æ–≥–æ—Ç–∏–ø" style="width:72px;height:72px;margin-bottom:12px;"/>
        <h1>{{ '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å' if role=='admin' else '–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç' }}</h1>
        <div class="muted">{{ '–í–æ–π–¥–∏—Ç–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–æ–º' if role=='admin' else '–í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç' }}</div>
      </div>

      {% if error %}
      <div class="message error" style="margin-bottom: 16px;">{{ error }}</div>
      {% endif %}

      <form method="POST" id="login-form" novalidate>
        <div class="form-group">
          <label>–õ–æ–≥–∏–Ω</label>
          <input type="text" name="username" required autofocus minlength="3" autocomplete="username" placeholder="–í–∞—à –ª–æ–≥–∏–Ω">
        </div>
        <div class="form-group field-with-icon">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input type="password" name="password" required minlength="6" autocomplete="current-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
          <span class="caps-warning" id="caps-warning">Warning: CapsLock –≤–∫–ª—é—á—ë–Ω!</span>
          <button type="button" class="toggle-password" aria-label="–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å">üëÅÔ∏è</button>
        </div>
        <button type="submit" class="submit-button" id="login-submit">üîê –í–æ–π—Ç–∏</button>
      </form>
    </div>

    <div style="text-align:center; margin-top: 16px;">
      <a href="/{{ 'admin' if role=='admin' else '' }}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
    {% if role=='admin' %}
    <div style="text-align:center; margin-top: 8px;">
      <a href="/login">–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
    </div>
    {% else %}
    <div style="text-align:center; margin-top: 8px;">
      <a href="/admin/login">–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
    </div>
    {% endif %}
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
(function(){
  const form = document.getElementById('login-form');
  const submitBtn = document.getElementById('login-submit');
  const toggleBtn = document.querySelector('.toggle-password');
  const passwordInput = form.querySelector('input[name="password"]');
  const usernameInput = form.querySelector('input[name="username"]');
  const capsWarning = document.getElementById('caps-warning');
  if (toggleBtn) {
    toggleBtn.addEventListener('click', () => {
      const isPwd = passwordInput.type === 'password';
      passwordInput.type = isPwd ? 'text' : 'password';
      toggleBtn.textContent = isPwd ? 'üôà' : 'üëÅÔ∏è';
    });
  }
  if (capsWarning && passwordInput) {
    passwordInput.addEventListener('keyup', function(e){
      if (e.getModifierState && e.getModifierState('CapsLock')) {
        capsWarning.style.display = 'inline';
      } else {
        capsWarning.style.display = 'none';
      }
    });
    passwordInput.addEventListener('blur', function(){ capsWarning.style.display = 'none'; });
  }
  function showInlineError(msg){
    let box = document.querySelector('.message.error');
    if (!box) {
      box = document.createElement('div');
      box.className = 'message error';
      form.parentElement.insertBefore(box, form);
    }
    box.textContent = msg;
  }
  form.addEventListener('submit', (e) => {
    if (!form.checkValidity()) {
      e.preventDefault();
      const u = usernameInput.value.trim();
      const p = passwordInput.value.trim();
      if (u.length < 3) return showInlineError('–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
      if (p.length < 6) return showInlineError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
      return showInlineError('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π');
    }
    if (submitBtn.dataset.loading === '1') {
      e.preventDefault();
      return;
    }
    submitBtn.dataset.loading = '1';
    submitBtn.disabled = true;
    const original = submitBtn.textContent;
    submitBtn.textContent = '‚è≥ –í—Ö–æ–¥–∏–º...';
    setTimeout(() => {
      submitBtn.disabled = false;
      submitBtn.dataset.loading = '0';
      submitBtn.textContent = original;
    }, 6000);
  });
})();
</script>
{% endblock %}


